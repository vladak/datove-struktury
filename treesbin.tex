% Souèást skript na Datové struktury. Viz main.tex
\markright{$ $Id$ $}

\chapter{Binární stromy}
% --------------------------------------------------------------------------
\section{Obecnì}

\subsection{Algoritmus MEMBER}
\subsection{Algoritmus INSERT}
\subsection{Algoritmus DELETE}

% --------------------------------------------------------------------------
\section{Optimální binární vyhledávací stromy}

XXX dopsat

\subsection{Algoritmus konstrukce}

XXX dopsat

\subsection{Sní¾ení slo¾itosti z kubické na kvadratickou}

XXX dopsat

% --------------------------------------------------------------------------
\section{Skorooptimální binární vyhledávací stromy}

% Jenom ¾e existují, lineární konstrukce. Aha --- viz cvièení.

\mnote{referát by Ladislav Strojil}
\newtheorem{fakt}{Fakt}

\renewcommand{\labelenumi}{\arabic{enumi})}
\newcommand{\oops}[1]{\textbf{#1}}

\subsection{Co je to optimální binární vyhledávací strom}

Prvky jsou ulo¾eny ve vnitøních vrcholech stromu. 
Listy jsou intervaly $(-\infty, x_1)$, $(x_1, x_2)$, 
$\ldots$, $(x_n, \inf)$. Listy nemusíme implicitnì
ve stromì zaznamenávat.
U optimálních stromù dále pøedpokládáme, ¾e známe pravdìpodobnosti 
operací $Access(x)$. 

\begin{defn} Nech» $S=\{x_1 < x_2 < \ldots < x_n\}$ 
a nech» $\beta_i$ (resp. $\alpha_j$) je prav\-dì\-po\-dob\-nost operace 
$Access(a,S)$, kde $a=x_i$ (resp. $x_j < a < x_{j+1}$) pro $1 \leq i \leq n$ 
(resp. $0 \leq j \leq n$).
Potom $\beta_i\geq0$, $\alpha_i\geq0$ a $\sum{\beta_i}+\sum{\alpha_i}=1$. 
(2n+1)-tice $(\alpha_0,\beta_1,\alpha_1,\ldots,\beta_n,\alpha_n)$ se nazývá 
rozdìlení (pravdìpodobnosti) pøístupu.
\end{defn}

Strom potom konstruujeme rekurzí tak, aby \emph{prùmìrná vá¾ená cesta} 
ve stro\-mì byla co nejkrat¹í.

Takový strom lze konstruovat pomocí rekurzivního výpoètu zkou¹ením v¹ech 
kandidátù na koøen. To lze v èase $O(n^2)$, proto¾e volba koøene jednoznaènì urèuje 
prvky pravého i levého podstromu (nebo» se jedná o vyhledávací strom).
\subsection{Aproximace optimálních stromù}

Pøi konstrukci se budeme sna¾it volbou koøene podstromu rozdìlit prvky na dvì stejnì pravdìpodobné mno¾iny.

Uva¾ujme následující situaci. $S=\{x_1, x_2, x_3, x_4\}$ s pravdìpodobnostmi pøí\-stu\-pu
($\alpha_0$, $\beta_1$, $\alpha_1$, $\beta_2$, $\alpha_2$, $\beta_3$, $\alpha_3$, $\beta_4$, $\alpha_4$) = 
$(\frac{1}{6},\frac{1}{24},0,\frac{ 1}{8},0,\frac{ 1}{8},\frac{ 1}{8}, 0,\frac{ 5}{12})$.

Doporuèuji si pøedstavit uvedené body na reálné ose tak, ¾e $\alpha_0$ je v bodì $0$, $\alpha_4$ v bodì $1$.

Bod $\frac{1}{2}$ padne buï do $\beta_i$ nebo do $\alpha_j$ pro nìjaké $i$, resp. $j$. V prvním pøípadì zvolíme $x_i$ jako 
koøen stromu, jinak volíme mezi $x_j$ a $x_{j+1}$, podle toho, zda $\frac{1}{2}$ le¾í v levé nebo pravé polovinì $\alpha_j$. 

V na¹em pøípadì volíme $x_3$ jako koøen stromu.

Pro rozhodnutí o koøenu levého podstromu vrchol, který popsaným zpù\-sobem odpovídá bodu $\frac{1}{4}$. Tento postup není toto¾ný s postupem, 
kdy se bere bod $\frac{1}{2}$ v 
novì vzniklé podúloze, proto¾e pøi konstrukci podstromu bychom zanedbali èást intervalu $\alpha_3$.

\subsection{Podrobnìj¹í popis naznaèené metody}

Nech» 
\begin{equation} 
s_0 = \frac{\alpha_0}{2} \\ s_i = s_{i-1} + \frac{\alpha_{i-1}}{2} + \beta_i + \frac{\alpha_i}{2}.
\end{equation}

Uvìdomte si, ¾e $s_i$ jsou støedy intervalù pøíslu¹ejících "neúspì¹nému vy\-hle\-dá\-vá\-ní", tj. $(x_i,x_{i+1})$.

Volání funkce $construct\_tree(0,n,0,1)$ vytvoøí skoro optimální vyhledávací strom dle popsané metody.

\ \newline
\oops{procedure} contruct\_tree(i,j,cut,l)

\emph{Poznámka: Pøedpokládáme, ¾e parametry volané funkce splòují následující podmínky.}
\begin{enumerate}
\item $i$ a $j$ jsou celá èísla taková, ¾e $0 \leq i < j \leq n$
\item $l$ je celé èíslo, $l \geq 0$
\item $cut=\sum_{p=1}^{l-1}{x_p 2^{-p}}$, kde $x_p \in \{0, 1\}$ pro v¹echna $p$
\item $cut \leq s_i \leq s_j \leq cut + 2^{-l+1}$
\end{enumerate}
\emph{Volání $construct\_tree(i,j,,)$ vytvoøí binární vyhledávací strom pro vrcholy $i+1, \ldots, j$ a listy $i, \ldots, j$.}

\oops{begin}

\ \ \ \oops{if} $i+1=j$ (pøípad A) \oops{return} koøen=j, levý list=i, pravý list=j;

\ \ \ \ \ \oops{else}

\ \ \ \ \ \ \ \ najdi k takové, ¾e

\ \ \ \ \ \ \ \ 5) $i < k \leq j$

\ \ \ \ \ \ \ \ 6) $k = i + 1$ nebo $s_{k-1} \leq cut + 2^{-l}$

\ \ \ \ \ \ \ \ 7) $k = j$ nebo $s_{k} \geq cut + 2^{-l}$

\ \ \ \ \ \ \ \ \emph{Takové $k$ v¾dy existuje, proto¾e parametry funkce splòují podmínku 4.}

\ \ \ \ \ \ \ \ \oops{if} $k = i + 1$ (pøípad B) \oops{return}

\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ koøen=i+1

\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ levý list=i

\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pravý list=\oops{construct\_tree}(i+1,j,cut+$2^{-l}$,l+1);

\ \ \ \ \ \ \ \ \oops{if} $k = j$ (pøípad C) \oops{return} 

\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ koøen=j

\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ levý list=\oops{construct\_tree}(i,j-1,cut,l+1)
	
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pravý list=j;

\ \ \ \ \ \ \ \ \oops{if} $i + 1 < k < j$ (pøípad D) \oops{return}

\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ koøen=k

\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ levý list=\oops{construct\_tree}(i,k-1,cut,l+1)
	
\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pravý list=\oops{construct\_tree}(k,j,cut+$2^{-l}$,l+1);

\oops{end}


\begin{theorem}
Nech» $b_i$ je hloubka vrcholu $x_i$ a $a_j$ je hloubka listu $(x_j,x_{j+1})$ ve stromì $T_{BB}$ vytvoøeném funkcí 
\oops{construct\_tree}(0,n,0,1). Potom

$b_i \leq \lfloor \log{1/\beta_i}\rfloor$, $a_j \leq \lfloor \log{1/\alpha_j}\rfloor + 2$ 
\end{theorem}

\begin{proof}
\emph{Vìta øíká, ¾e hloubka vrcholu roste s klesající pravdìpodobností pøístupu k tomuto vrcholu.}

Plyne z následujících faktù.
\end{proof}

\begin{fakt}
Jestli¾e hodnoty parametrù funkce \oops{construct\_tree} splòují 
podmínky 1-4 a $i + 1 \neq j$, potom k splòující po¾adované podmínky existuje 
a hodnoty parametrù rekurzivních volání \oops{construct\_tree} splòuji 1-4.
\end{fakt}

\begin{proof} 
\ \par
Pøedpokládejme, ¾e parametry splòují 1 -- 4 a $i + 1 \neq j$. 
Potom zøejmì platí $cut \leq s_j \leq cut + 2^{-l+1}$. Pro spor pøedpokládejme, 
¾e neexistuje neexistuje ¾ádné $k$, $i < k \leq j$, pro které 
by platilo $s_{k-1} \leq cut+2^{-l}$ a $s_{k} \geq cut+2^{-l}$. 

Potom ov¹em buï pro v¹echna $k$ taková, ¾e $i < k \leq j$, 
platí $s_{k} < cut+2^{-l}$ nebo 
pro v¹echna $k$ taková, ¾e $i < k \leq j$, platí $s_{k-1} > cut+2^{-l}$.

V prvním pøípadì $k = j$ odpovídá po¾adovaným podmínkám, 
v druhém jim odpovídá $k = i + 1$. Tedy $k$ v¾dy existuje.

Zbývá ukázat, ¾e nové parametry volání funkce splòují po¾adované 
pod\-mín\-ky. To ale plyne z toho, ¾e $k$ splòuje 5-7 a  $i+1 \neq j$.
\end{proof}

\begin{fakt}
Hodnoty parametrù v¹ech volání \oops{construct\_tree} splòují podmínky 1-4.
\end{fakt}
\begin{proof} 
Indukcí. \oops{construct\_tree}(0, n, 0, 1) splòuje 1-4 a pomocí pøedchozího faktu.
\end{proof}

Øekneme, ¾e vrchol $h$ (resp. list $h$) je vytvoøen voláním 
\oops{construct\_tree}(i, j, cut, l), jestli¾e $h = j$ (resp. $h =j$ nebo $h = i$) a 
byl proveden pøípad A, nebo $h = i + 1$ (resp. $h = i$) a byl proveden pøípad B, 
nebo $h = j$ a byl proveden pøípad C, nebo  $h = k$ 
a byl proveden pøípad D.

Dále nìch» $b_i$ je hloubka vrcholu $i$ a $a_j$ hloubka listu $j$ ve 
stromì vráceném $construct\_tree(0,n,0,1)$.

\begin{fakt}
Je-li vrchol $h$ (resp. list $h$) vytvoøen voláním 
$construct\_tree(i,j,cut,l)$, potom $b_h + 1 = l$ (resp. $a_h = l$).
\end{fakt}
\begin{proof}
Indukcí podle $l$. 
\end{proof}
\begin{fakt}
Je-li vrchol $h$ (resp. list $h$) vytvoøen voláním 
$construct\_tree(i,j,cut,l)$, potom $\beta_h \leq 2^{-l+1}$ (resp. $\alpha_h \leq 2^{-l+2}$).
\end{fakt}
\begin{proof}
Parametry splòují 4 a tedy
$2^{l+1} \geq s_j - s_i = (\alpha_i + \alpha_j)/2 + \beta_{i+1} + \alpha_{i+1} + \ldots + \beta_j \geq \beta_h$ (resp. $\alpha_h/2$)
\end{proof}

\begin{proof}[vìty]
Z faktù 3 a 4 obdr¾íme $\beta_h \leq 2^{-b_h}$ a $\alpha_h \leq 2^{-a_h+2}$. 
Zlogaritmováním a pøevedením na celoèíselné hodnoty dostáváme tvrzení vìty.
\end{proof}

Vìty 1 a 2 ukazují, ¾e hloubka vrcholu je pøibli¾nì rovna logaritmu 
pøe\-vrá\-ce\-né hodnoty prav\-dì\-po\-dob\-nosti pøístupu k tomuto vrcholu.

\begin{defn}
Nech» $(\gamma_1,\gamma_2, \ldots, \gamma_n)$ je diskrétní rozdìlení 
pravdìpodobnosti. Potom se funkce 
$H(\gamma_1,\gamma_2, \ldots, \gamma_n) = - \sum_{i = 1}^{n}\gamma_i\log{\gamma_i}$ 
nazývá entropie rozdìlení.
\end{defn}

Pov¹imnìte si, ¾e entropie nezále¾í na vytvoøeném stromì, 
jenom na prav\-dì\-po\-dob\-nostech pøístupu. 

\begin{theorem}
Nech» $P_{BB}$ je vá¾ená délka cesty zkonstruovaného stromu. Potom

\begin{eqnarray} 
\nonumber P_{BB} \leq \sum{\beta_i} \lfloor\log{1/\beta_i}\rfloor + \sum{\alpha_j} \lfloor\log{1/\alpha_j}\rfloor + 1 + \sum{\alpha_j} \leq
\\ \leq H(\alpha_0,\beta_1,\alpha_1,\ldots,\beta_n,\alpha_n) + 1 + \sum{\alpha_j}
\end{eqnarray} 
\end{theorem}
Navíc
\begin{theorem}
Nech» $P_{BB}$ je vá¾ená délka cesty zkonstruovaného stromu a nech» 
$P_{opt}$ je vá¾ená délka cesty v optimálním stromu. ($B = \sum\beta_i$) 
Potom 
\begin{enumerate}
\item $\max\{\frac{H-dB}{\log{(2+2^{-d})}}; d \in \mathbf{R}\} \leq P_{opt} \leq P_{BB} \leq H + 1 + \sum{\alpha_j}$
\item $P_{BB} \leq P_{opt} + B(\log e + \log(P_{opt}/B)) + 2\sum{\alpha_j}$
\end{enumerate}

\end{theorem}
\begin{proof}
Plyne z vìty 5 (pùvodní èíslování, viz \cite{mehlhorn}, strana 175) a vìty 2.
\end{proof}

Je to jenom slo¾ité poèítání, jde o to, ¾e dovedeme odhadnout, 
jak velká dovede být ta vá¾ená cesta v námi vytvoøeném stromì.

$P_{BB} - P_{opt} \leq \log P_{opt}$, co¾ je pøibli¾nì $log H$.

\subsection{Èasová slo¾itost}

Pro sestrojení stromu s jedním vrcholem potøebuje metoda konstatní èas, tj. $T(1)=c_1$.

Pro $n > 1$ je potøeba najít $k$ a dojde a¾ ke dvìma rekurzivním 
voláním \oops{construct\_tree}.
Nech» $T(m,n)$ je èas potøebný pro nalezení $k$, kde $m = k - i$ 
(tj. vzdálenost k od poèátku zkoumaného úseku).
\oops{construct\_tree} je voláno maximálnì dvakrát, v pøípadì D první 
volání sestrojí strom s $k - 1 - i = m - 1$ 
vrcholy a druhé volání strom s $j - k = n - m$.

Tedy $T(n) \leq \max(T(m-1) + T(n-m) + T_S(n,m) + c_2)$.

Zde $c_2$ je konstanta mìøící slo¾itost pøedávání parametrù.

Dodefinujeme-li $T(0) = 0$, potom uvedená nerovnost platí i pro pøípady 
B a C. Zavedeme-li dále konvenci $T_S(1,m) = 0$ a 
$c = max(c_1, c_2)$, dotáváme zjednodu¹ený výraz:

\begin{equation} 
T(0) = 0 \\
T(n) \leq \max_{1 \leq m < n}(T(m-1) + T(n-m) + T_S(n,m) + c)
\end{equation} 


\subsection{Hledání $k$}

Èíslo $k$ mù¾eme hledat binárním vyhledáváním (pùlení intervalu), 
ale výsledná èasová slo¾itost by byla $O(n\log n)$

Principiální problém s vyhledáváním pomocí pùlení intervalu je, 
¾e nám nalezení $k$ trvá dlouho i v pøípadì, ¾e je blízko
$i$ nebo $j$ a tedy neredukuje velikost podúlohy podstatným zpùsobem.

Øe¹ením je kombinace exponenciálního a binárního vyhledávání. 
Tím do\-sáh\-ne\-me toho, ¾e $k$, která jsou blízko krajním 
bodùm intervalu, nalezneme rychleji.

Budeme vyhledávat od koncù intervalu, ale ne v konstatních krocících.

$1)$ Porovnáme $s_r$ s $cut + 2^{-l}$, kde $r = \lfloor(i + 1 + j) / 2\rfloor$. 
Je-li $s_r \geq cut + 2^{-l}$, potom $k \in \{i + 1, \ldots, r\}$. 
Je-li $s_r \leq cut + 2^{-l}$, potom $k \in \{r, \ldots, j\}$. 
V dal¹ím budeme pøedpokládat, ¾e $k \in \{i + 1, \ldots, r\}$. 

Tento krok trvá konstantní èas.

$2)$ Nalezneme nejmen¹í $t$, $t = 0, 1, 2, \ldots$, takové, ¾e $s_{i+2^t} \geq cut + 2^{-l}$.
Nazvìme jej $t_0$. $t_0$ lze nalézt v èase $d_2(t_0 + 1)$ pro nìjakou konstantu $d_2$.

Potom $i + 2^{t_0-1} < k \leq i + 2^{t_0}$, tj. $2^{t_0} \geq k - i = m > 2^{t_0-1}$ a odtud $\log m > t_0 - 1$. 
Tedy trvání kroku 2 je omezené $d_2(2 + log m)$.

$3)$ Binárním vyhledáváním na intervalu 
$i + 2^{t_0-1} + 1, \ldots, i + 2^{t_0}$ zjistíme pøesnou hodnotu $k$.

Tohle zabere $d_3(log(2^{t_0} - 2^{t_0-1}) + 1) = d_3 t_0 < d_3(1 + \log m)$ 
(pro nìjakou konstantu $d_3$).

Tedy pro $i < k \leq \lfloor(i + 1 + j) / 2\rfloor$ nalezneme $k$ 
v èase men¹ím ne¾ $d_3(1 + \log m)$. Zde se $m = k -i$. Symetricky lze $k$
nalézt v èase $\leq d(1 + \log(n - m + 1))$, v pøípadì, ¾e $\lfloor(i + 1 + j) / 2\rfloor < k$.

Tedy $T_S(n,m) = d(1 + \log \min(m, n - m + 1))$

Dostáváme pro \oops{construct\_tree} následující rekurzivní vztah.
\begin{eqnarray} 
\nonumber && T(0) = 0  \\
\nonumber && T(n) = \max_{1 \leq m < n}(T(m-1) + T(n-m) + d(1 + \log \min(m, n - m + 1)) + c)
\end{eqnarray} 

\begin{theorem}
Je-li vyhledávání $k$ implementováno pomocí uvedené kombinace exponenciálního 
a binárního vyhledávání, potom $T(n) = O(n)$.
\end{theorem}

\begin{proof}
Indukcí podle $n$ uká¾eme $T(n) \leq (2d + c)n - d\log(n + 1)$.

Pro $n=0$ vztah zøejmì platí.

Pro $n > 0$ máme 
\begin{equation} 
T(n) = \max_{1 \leq m < n}(T(m-1) + T(n-m) +  d(1 + \log \min(m, n - m + 1)) + d + c) 
\end{equation} 

Tedy podle symetrie výrazu v $m - 1$ a $n - m$ dostáváme:
\begin{equation} 
T(n) \leq \max_{1 \leq m < (n+1)/2}(T(m-1) + T(n-m) +  d\log m + d + c)
\end{equation} 

Podle indukèního pøedpokladu dostáváme
\begin{eqnarray} 
\nonumber T(n) & \leq & \max_{1 \leq m < (n+1)/2}((2d+c)(m-1+n-m)- \\ && -\ d(\log m + \log(n-m+1)) + d \log m + (d +c))
\end{eqnarray} 

Co¾ se rovná
\begin{equation} 
(2d+c)n + \max_{1 \leq m < (n+1)/2}(-d(1 + \log m - m + 1))
\end{equation} 

Výraz v závorce je v¾dy men¹í ne¾ nula a je nejvìt¹í pro 
$m = (n + 1) / 2$. Tedy dostáváme následující nerovnost:
\begin{equation} 
T(n) \leq (2d+c)n - d(1 + \log(n+1)/2) = (2d+c)n - d\log(n+1) 
\end{equation} 
\end{proof}



% --------------------------------------------------------------------------
\section{Èervenoèerné stromy}

Ka¾dý vrchol je obarven èervenì nebo èernì a platí následující podmínky:
\begin{enumerate}
\item Listy jsou èerné.
\item Pokud má èervený vrchol otce, je otec èerný.
\item V¹echny cesty z koøene do listu mají stejný poèet èerných vrcholù.
\end{enumerate}

Pro binární vyhledávací èervenoèerné stromy reprezentující mno¾inu $S$
platí: je-li $k$ poèet èerných vrcholù na cestì z koøene do listu, pak
\[
2^k -1 \leq |S| \leq 2^{2k} -1
\]
neboli
\[
k \leq \log_2 |S| +1 \leq 2k
\]
pøièem¾ prvky $S$ jsou reprezentovány pouze ve vnitøních vrcholech, ne
v listech.
\mnote{je to novinka?}

\subsection{Operace INSERT}
Uvedeme pouze odli¹nost od operace INSERT v obecném binárním
vyhledávacím stromì.

Situace: list $t$ se zmìnil na vnitøní vrchol reprezentující prvek $x$
a pøidali jsme mu 2 listy.

Vrchol $t$ obarvíme èervenì a jeho syny èernì. Podmínky 1 a 3 stále
platí, ale podmínka 2 platit nemusí.
\begin{defn}
Strom a jeho vrchol $(T,t)$ nazveme \emph{2-témìø èervenoèerný strom
(2tèès),} jestli¾e platí
\begin{itemize}
\item{1} Listy jsou èerné. {\it (nezmìnìno)}
\item{2'} Pokud má èervený vrchol \emph{rùzný od $t$} otce, je otec
èerný.
\mnote{Srovnej: Ka¾dý èervený vrchol rùzný od $t$ má èerného otce.}
\item{3} V¹echny cesty z koøene do listu mají stejný poèet èerných
vrcholù. {\it (nezmìnìno)}
\end{itemize}
\end{defn}
\begin{defn}
Je-li vrchol $t$ èervený a jeho otec je také èervený, pak øekneme, ¾e
$t$ je \emph{porucha}.
\end{defn}
Tedy nyní máme 2tèès $(T,t)$ Je-li $t$ porucha, pak ji musíme nìjak
opravit. Situace je na obrázku \ref{rbt-i}.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-i}
\caption{Obecná situace pøi INSERTu}
\label{rbt-i}
\end{figure}
Nejprve zále¾í na tom, jakou barvu má $s$, strýc $t$:
\begin{enumerate}
\item $s$ je èervený. Pak pouze pøebarvíme $o$, $d$ a $s$ podle
obrázku \ref{rbt-i1}.
Podmínky 1 a 3 jsou splnìny. Nyní $d$ mù¾e být porucha, ov¹em posunutá o 2
hladiny vý¹e. Vznikl 2tèès $(T,d)$.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-i1}
\caption{Oprava INSERTu pøebarvením}
\label{rbt-i1}
\end{figure}
\item $s$ je èerný. Zále¾í na tom, zda hodnota $t$ le¾í mezi hodnotami
$o$ a $d$ nebo ne. Jinými slovy, zda cesta $t$-$o$-$d$ obsahuje
zatáèku.
\begin{enumerate}
\item Bez zatáèky:
Provedeme rotaci a pøebarvíme podle obrázku \ref{rbt-i2a}.
Splnìny budou podmínky 1, 2 i 3, tedy máme èervenoèerný strom.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-i2a}
\caption{Oprava INSERTu rotací a pøebarvením}
\label{rbt-i2a}
\end{figure}
\item Se zatáèkou:
Provedeme dvojitou rotaci a pøebarvíme podle obrázku \ref{rbt-i2b}.
Splnìny budou podmínky 1, 2 i 3, opìt máme rovnou èervenoèerný strom.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-i2b}
\caption{Oprava INSERTu dvojitou rotací a pøebarvením}
\label{rbt-i2b}
\end{figure}
\end{enumerate}
\end{enumerate}

\subsection{Operace DELETE}
Zatímco INSERT se pøíli¹ neli¹il od své obdoby u AVL stromù, operace
DELETE u èervenoèerných stromù je oproti AVL stromùm slo¾itìj¹í
mentálnì, ov¹em jednodu¹¹í èasovì.

Situace: odstraòujeme vrchol $t$ (který nemusí reprezentovat
odstraòovaný prvek --- viz DELETE v obecných binárních vyhledávacích
stromech) a jeho syna, který je list.

Druhého syna $t$, $u$, dáme na místo smazaného $t$ a zaèerníme ho. Tím
máme splnìné podmínky 1 a 2. Pokud byl ale $t$ èerný, chybí nám na
cestách procházejících nyní $u$ jeden èerný vrchol.
\begin{defn}
Strom a jeho vrchol $(T,u)$ nazveme \emph{3-témìø èervenoèerný strom
(3tèès),} jestli¾e platí
\begin{itemize}
\item{1} Listy jsou èerné. {\it (nezmìnìno)}
\item{2} Pokud má èervený vrchol otce, je otec èerný. {\it (nezmìnìno)}
\item{3'}
V¹echny cesty z koøene do listu neprocházející $u$ mají stejný poèet
èerných vrcholù, nech» je to $k$. 
V¹echny cesty z koøene do listu   procházející $u$ mají stejný poèet
èerných vrcholù, nech» je to $\ell$. 
A platí $k-1 \leq \ell \leq k$.
\end{itemize}
Kdy¾ $u$ není koøen a $\ell < k$, pak øekneme, ¾e $u$ je \emph{porucha}.
\end{defn}

Nech» vrchol $u$  je porucha. Pak mù¾eme pøedpokládat, ¾e je 
obarven èernì, jinak bychom ho pøebarvili na èerno a tím by se porucha 
odstranila a vznikl èervenoèerný strom.

Situace: máme 3tèès $(T,u)$, $u$ je porucha s otcem $o$, bratrem $b$ a
synovci $s1$, $s2$, viz obrázek \ref{rbt-d}.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-d}
\caption{Obecná situace pøi DELETE}
\label{rbt-d}
\end{figure}
Oprava zále¾í na barvì $b$:
\begin{enumerate}
\item Bratr je èerný. 
Rozli¹ujeme dále 4 pøípady, z nich¾ jeden propaguje poruchu o hladinu
vý¹ a ostatní skonèí s èervenoèerným stromem.
\begin{enumerate}
\item Otec i synovci jsou èerní.
Pøebarvíme $b$ na èerveno, viz obrázek \ref{rbt-d1a}. Dostáváme 3tèès $(T,o)$,
tedy porucha je o hladinu vý¹e.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-d1a}
\caption{Èásteèná oprava DELETE pøebarvením}
\label{rbt-d1a}
\end{figure}
\item \label{rbt-cd1b} Otec je èervený, synovci èerní.
Pøebarvíme otce a bratra podle obrázku \ref{rbt-d1b} a dostáváme
èervenoèerný strom.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-d1b}
\caption{Oprava DELETE pøebarvením}
\label{rbt-d1b}
\end{figure}
\item \label{rbt-cd1c} Synovec $s1$, jeho¾ hodnota le¾í mezi hodnotami
otce a bratra, je èerný, druhý synovec je èervený.
Pøebarvíme a zrotujeme podle obrázku \ref{rbt-d1c}, barva otce se
nemìní (tj., vrchol $b$ bude mít barvu, kterou pùvodnì mìl vrchol $o$).
Dostáváme èervenoèerný strom.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-d1c}
\caption{Oprava DELETE pøebarvením a rotací}
\label{rbt-d1c}
\end{figure}
\item \label{rbt-cd1d} Synovec $s1$, jeho¾ hodnota le¾í mezi hodnotami
otce a bratra, je èervený, druhý synovec má libovolnou barvu.
Pøebarvíme a dvojitì zrotujeme podle obrázku \ref{rbt-d1d} (tj., vrchol $s1$ 
bude mít barvu, kterou pùvodnì mìl vrchol $o$ a barva vrcholu $s2$ se nezmìní).
Dostáváme èervenoèerný strom.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-d1d}
\caption{Oprava DELETE pøebarvením a dvojitou rotací}
\label{rbt-d1d}
\end{figure}
\end{enumerate}
\item Bratr je èervený.
Pøebarvíme a zrotujeme podle obrázku \ref{rbt-d2}.
Dostáváme 3tèès $(T,u)$, pøièem¾ porucha je o hladinu ní¾e. I kdy¾ to
tak na první pohled nevypadá, máme vyhráno, proto¾e bratr poruchy je
èerný a otec èervený, tedy pøí¹tí oprava bude pøípad \ref{rbt-cd1b},
\ref{rbt-cd1c}, nebo \ref{rbt-cd1d} a skonèíme s èervenoèerným stromem.
\begin{figure}[!htb]
\centering\includegraphics{pics/rbt-d2}
\caption{Èásteèná oprava DELETE pøebarvením a rotací}
\label{rbt-d2}
\end{figure}
\end{enumerate}

\subsection{Závìry}
Pro binární vyhledávací èervenoèerné stromy lze implementovat MEMBER,
INSERT a DELETE tak, ¾e vy¾adují èas $O(\log n)$ a INSERT pou¾ívá
nejvý¹e jednu (dvojitou) rotaci a DELETE pou¾ívá nejvý¹e dvì rotace
nebo rotaci a dvojitou rotaci. 

Jsou lep¹í ne¾ AVL stromy, které pøi DELETE spotøebují a¾ $\log n$
rotací. Oproti váhovì vyvá¾eným stromùm i proti AVL stromùm jsou 
èervenoèerné stromy jen
konstantnì lep¹í, ale i to je dobré. Pøi pou¾ití binárních vyhledávacích 
stromù ve výpoèetní geometrii nese informaci i rozlo¾ení prvkù ve stromì, 
a tato informace se musí po provedení rotace nebo dvojité rotace aktualizovat. 
To znamená prohledání celého stromu a tedy èas $O(n)$ za ka¾dou rotaci a 
dvojitou rotaci navíc. Pro tyto problémy jsou èervenoèerné stromy obzvlá¹tì 
vhodné, proto¾e minimalizují poèet pou¾itých rotací a dvojitých rotací. 

Èervenoèerné stromy se pou¾ívají pøi implementaci $(2,4)$-stromù, se
kterými se seznámíme v dal¹í kapitole. Vrchol 
se dvìma syny je nahrazen jedním èerným vrcholem, vrchol se tøemi syny 
je nahrazen èerným vrcholem s jedním èerveným synem a vrchol se ètyømi 
syny je nahrazen èerným vrcholem se dvìma syny. Pozor! Aktualizaèní 
operace pro $(2,4)$-stromy neodpovídají aktualizaèním operacím na 
èervenoèerných stromech (i reprezentace prvkù je odli¹ná).

Èervenoèerné stromy se pou¾ívají napøíklad ve 
\href{http://www.sgi.com/tech/stl/}%
{standardní ¹ablonové knihovnì jazyka C++ od SGI}, 
která je zahrnuta do GCC. Máte-li Linux, zkuste se podívat do
\path{/usr/include/g++-2/stl\_tree.h}.
\footnote{A pokud víte o podobnì dostupných implementacích jiných
datových struktur z téhle pøedná¹ky, sem s nimi!}
